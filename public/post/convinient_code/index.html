<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>最近便利だと感じているコード集 - Rikiya&#39;s blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="最近便利だと感じているコード集" />
<meta property="og:description" content="今回は、便利だなと思うコード集を集めてみました。 では、早速見ていきましょう！ 動作環境 version ## _ ## platform x86_64-w64-mingw32 ## arch x86_64 ## os mingw32 ## system x86_64, mingw32 ## status ## major 4 ## minor 0.3 ## year 2020 ##" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/convinient_code/" />
<meta property="article:published_time" content="2021-04-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-02T00:00:00+00:00" />

		<meta itemprop="name" content="最近便利だと感じているコード集">
<meta itemprop="description" content="今回は、便利だなと思うコード集を集めてみました。 では、早速見ていきましょう！ 動作環境 version ## _ ## platform x86_64-w64-mingw32 ## arch x86_64 ## os mingw32 ## system x86_64, mingw32 ## status ## major 4 ## minor 0.3 ## year 2020 ##">
<meta itemprop="datePublished" content="2021-04-02T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-04-02T00:00:00+00:00" />
<meta itemprop="wordCount" content="1327">



<meta itemprop="keywords" content="" />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="最近便利だと感じているコード集"/>
<meta name="twitter:description" content="今回は、便利だなと思うコード集を集めてみました。 では、早速見ていきましょう！ 動作環境 version ## _ ## platform x86_64-w64-mingw32 ## arch x86_64 ## os mingw32 ## system x86_64, mingw32 ## status ## major 4 ## minor 0.3 ## year 2020 ##"/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="A piece of cake" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">A piece of cake</div>
					<div class="logo__tagline">But cake is always sweet</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">最近便利だと感じているコード集</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">Rikiay Honda</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2021-04-02T00:00:00Z">2021-04-02</time></div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		
	</div>
</div>
<div class="content post__content clearfix">
			


<p>今回は、便利だなと思うコード集を集めてみました。</p>
<p>では、早速見ていきましょう！</p>
<div id="動作環境" class="section level3">
<h3>動作環境</h3>
<pre class="r"><code>version</code></pre>
<pre><code>##                _                           
## platform       x86_64-w64-mingw32          
## arch           x86_64                      
## os             mingw32                     
## system         x86_64, mingw32             
## status                                     
## major          4                           
## minor          0.3                         
## year           2020                        
## month          10                          
## day            10                          
## svn rev        79318                       
## language       R                           
## version.string R version 4.0.3 (2020-10-10)
## nickname       Bunny-Wunnies Freak Out</code></pre>
</div>
<div id="パッケージの準備" class="section level3">
<h3>パッケージの準備</h3>
<p>data wanglingで必要となる一般的なパッケージを準備しておきます。</p>
<pre class="r"><code>Packages &lt;- c(&quot;tidyverse&quot;, &quot;lubridate&quot;)
lapply(Packages, library, character.only = TRUE)</code></pre>
</div>
<div id="ggextraggmarginal" class="section level3">
<h3>ggExtra::ggMarginal</h3>
<p>これは、散布図と分布図を同時にプロットできる関数です。</p>
<p>ggplotと共にに使います。</p>
<p>データは、<a href="https://www.amazon.co.jp/R%E3%81%AB%E3%82%88%E3%82%8B%E5%AE%9F%E8%A8%BC%E5%88%86%E6%9E%90-%E2%80%95%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%8B%E3%82%89%E5%9B%A0%E6%9E%9C%E5%88%86%E6%9E%90%E3%81%B8%E2%80%95-%E6%98%9F%E9%87%8E%E5%8C%A1%E9%83%8E/dp/427421947X">Rによる実証分析　回帰分析から因果分析へ</a>を基に作成しています。</p>
<pre class="r"><code>path &lt;- &quot;~/R/learn_R/Rによる実証分析　回帰分析から因果分析へ/Data/02 演習用データ集/&quot;
(df &lt;- read_csv(paste0(path, &quot;data_4_1.csv&quot;)) %&gt;% 
    mutate(
      date = lubridate::ymd(date)
    ))</code></pre>
<pre><code>## # A tibble: 744 x 5
##    date        time  elec  prec  temp
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2014-08-01     0  3193     0  27.9
##  2 2014-08-01     1  2960     0  27.9
##  3 2014-08-01     2  2807     0  27.1
##  4 2014-08-01     3  2748     0  26.8
##  5 2014-08-01     4  2735     0  26.9
##  6 2014-08-01     5  2736     0  27.3
##  7 2014-08-01     6  2950     0  28.3
##  8 2014-08-01     7  3336     0  29.4
##  9 2014-08-01     8  3863     0  30.2
## 10 2014-08-01     9  4328     0  32.2
## # ... with 734 more rows</code></pre>
<pre class="r"><code>df &lt;- df %&gt;% 
  mutate(
    daytime = (time &gt;= 9 &amp; time &lt;= 18),
    wday = wday(date, label = TRUE, local = &quot;English&quot;),
    sunday = (wday == &quot;Sun&quot;), # sundayダミーを追加
    recess = (date %in% seq(ymd(&quot;2014-08-11&quot;), ymd(&quot;2014-08-16&quot;), by = &quot;day&quot;))
  )
df</code></pre>
<pre><code>## # A tibble: 744 x 9
##    date        time  elec  prec  temp daytime wday  sunday recess
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;ord&gt; &lt;lgl&gt;  &lt;lgl&gt; 
##  1 2014-08-01     0  3193     0  27.9 FALSE   Fri   FALSE  FALSE 
##  2 2014-08-01     1  2960     0  27.9 FALSE   Fri   FALSE  FALSE 
##  3 2014-08-01     2  2807     0  27.1 FALSE   Fri   FALSE  FALSE 
##  4 2014-08-01     3  2748     0  26.8 FALSE   Fri   FALSE  FALSE 
##  5 2014-08-01     4  2735     0  26.9 FALSE   Fri   FALSE  FALSE 
##  6 2014-08-01     5  2736     0  27.3 FALSE   Fri   FALSE  FALSE 
##  7 2014-08-01     6  2950     0  28.3 FALSE   Fri   FALSE  FALSE 
##  8 2014-08-01     7  3336     0  29.4 FALSE   Fri   FALSE  FALSE 
##  9 2014-08-01     8  3863     0  30.2 FALSE   Fri   FALSE  FALSE 
## 10 2014-08-01     9  4328     0  32.2 TRUE    Fri   FALSE  FALSE 
## # ... with 734 more rows</code></pre>
<pre class="r"><code>(mod3 &lt;- lm(elec ~ temp + daytime + prec + sunday + recess, data = df))</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime + prec + sunday + recess, 
##     data = df)
## 
## Coefficients:
## (Intercept)         temp  daytimeTRUE         prec   sundayTRUE   recessTRUE  
##      179.07       113.48       563.53        14.27      -448.39      -438.23</code></pre>
<pre class="r"><code>library(modelr)
df1 &lt;- df %&gt;% 
  add_residuals(mod3)

g &lt;- ggplot(df1, aes(date, resid)) +
  geom_ref_line(h = 0) +
  geom_point(alpha = 0.25)

library(ggExtra)
ggExtra::ggMarginal(
  g,
  type = &quot;density&quot;,
  margins = &quot;y&quot;,
  size = 5
)</code></pre>
<p><img src="/post/convinient_code/index_files/figure-html/ggExtra-1.png" width="672" /></p>
</div>
<div id="無名関数" class="section level3">
<h3>無名関数</h3>
<p>R言語での無名関数は、命名していない関数のことです。</p>
<p>こんな感じで使います。</p>
<p>データは先ほどロードした<code>df</code>から再利用してます。</p>
<p>一度に複数の関数を計算させることができるので便利ですね。</p>
<pre class="r"><code>funs &lt;- list(sum = sum,
             mean = mean,
             median = median) # データはlist型でないといけない

lapply(funs, function(f) f(df$prec)) # 降水量の合計、平均、中央値を表示</code></pre>
<pre><code>## $sum
## [1] 105
## 
## $mean
## [1] 0.141129
## 
## $median
## [1] 0</code></pre>
</div>
<div id="赤池情報量基準" class="section level3">
<h3>赤池情報量基準</h3>
<p>step{stats}という関数なのですが、赤池情報量基準(Akaike’s Information Criterion: AIC)を計算する関数になります。</p>
<p>AICは、値が小さいほど良いモデルとされているそうです。</p>
<p>使い方は、多変量解析をする際に、変数が増えてしまうと増加してしまう決定係数（R-squared)の値を、変数選択によって小さくするために使います。</p>
<p>このケースを使うと、最下部に表示されている<code>elec ~ temp + daytime + sunday + recess</code>が多変量解析する際の良いモデルということになります。</p>
<pre class="r"><code>(mod3 &lt;- lm(elec ~ temp + daytime + prec + sunday + recess, data = df))</code></pre>
<pre><code>## 
## Call:
## lm(formula = elec ~ temp + daytime + prec + sunday + recess, 
##     data = df)
## 
## Coefficients:
## (Intercept)         temp  daytimeTRUE         prec   sundayTRUE   recessTRUE  
##      179.07       113.48       563.53        14.27      -448.39      -438.23</code></pre>
<pre class="r"><code>stmod3 &lt;- step(mod3)</code></pre>
<pre><code>## Start:  AIC=8806.38
## elec ~ temp + daytime + prec + sunday + recess
## 
##           Df Sum of Sq       RSS    AIC
## - prec     1    129275 101312700 8805.3
## &lt;none&gt;                 101183425 8806.4
## - sunday   1  18965310 120148735 8932.2
## - recess   1  21252300 122435724 8946.2
## - daytime  1  49305718 150489142 9099.7
## - temp     1 100441924 201625349 9317.4
## 
## Step:  AIC=8805.33
## elec ~ temp + daytime + sunday + recess
## 
##           Df Sum of Sq       RSS    AIC
## &lt;none&gt;                 101312700 8805.3
## - sunday   1  18840602 120153302 8930.2
## - recess   1  21180925 122493625 8944.6
## - daytime  1  50322970 151635670 9103.4
## - temp     1 102307200 203619900 9322.7</code></pre>
</div>
<div id="最後に" class="section level3">
<h3>最後に、、、</h3>
<p>今回は、自分へのメモとして駆け足で書いてしまいました。</p>
<p>最後のまで読んでいただきありがとうございます！！</p>
<p>Adios!!</p>
</div>
<div id="参考文献" class="section level3">
<h3>参考文献</h3>
<ul>
<li><a href="https://www.amazon.co.jp/R%E3%81%AB%E3%82%88%E3%82%8B%E5%AE%9F%E8%A8%BC%E5%88%86%E6%9E%90-%E2%80%95%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%8B%E3%82%89%E5%9B%A0%E6%9E%9C%E5%88%86%E6%9E%90%E3%81%B8%E2%80%95-%E6%98%9F%E9%87%8E%E5%8C%A1%E9%83%8E/dp/427421947X">Rによる実証分析　回帰分析から因果分析へ</a></li>
<li><a href="https://bookwalker.jp/def7157cac-00c4-41c0-bd8a-68e40f759f0c/?adpcnt=7qM_Vsc7&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_term=_&amp;utm_campaign=&amp;utm_content=__cp_1471997507_gr_65566109508_kw_pla-428567606763_cr_281840075652&amp;gclid=EAIaIQobChMIhr-JmZTd7wIVgmkqCh2w9AyWEAQYAiABEgI09vD_BwE">Rによる計量経済学（第2版）</a></li>
</ul>
</div>

		</div>
	</article>
</main>

<div class="authorbox clearfix">
	<div class="authorbox__header">
		<span class="authorbox__name"></span>
	</div>
	<div class="authorbox__description">
		Rikiya Honda&rsquo;s true identity is friendly, eager to improve, and open to every constructive comments. Maybe he is a successful blogger or writer. Who knows?
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/post/the_law_of_large_number_with_shiny/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大数の法則 with Shiny</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Rikiya Honda.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>